{"version":3,"sources":["../src/createSubscription.js"],"names":["createSubscription","subscribe","remove","value","subscribing","updaters","Set","getCurrentValue","update","add","size","nextValue","forEach","updater","delete","unsubscribe"],"mappings":";;AAAA,eAAe,SAASA,kBAAT,CAA4BC,UAA5B,EAAuCC,MAAvC,EAA+C;AAC5D,MAAIC,KAAJ;AACA,MAAIC,WAAJ;AACA,MAAMC,QAAQ,GAAG,IAAIC,GAAJ,EAAjB;AACA,SAAO;AACLC,IAAAA,eAAe,EAAE;AAAA,aAAMJ,KAAN;AAAA,KADZ;AAELF,IAAAA,SAAS,EAAE,mBAAAO,MAAM,EAAI;AACnBH,MAAAA,QAAQ,CAACI,GAAT,CAAaD,MAAb;;AACA,UAAIH,QAAQ,CAACK,IAAT,KAAkB,CAAtB,EAAyB;AACvBN,QAAAA,WAAW,GAAG;AAAA;AAAA,iCAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAEEH,UAAS,CAAC,UAAAU,SAAS,EAAI;AAClCR,oBAAAA,KAAK,GAAG,CAAC,IAAD,EAAOQ,SAAP,CAAR;AACAN,oBAAAA,QAAQ,CAACO,OAAT,CAAiB,UAAAC,OAAO;AAAA,6BAAIA,OAAO,EAAX;AAAA,qBAAxB;AACD,mBAHqB,CAFX;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAOXV,kBAAAA,KAAK,GAAG,aAAR;AACAE,kBAAAA,QAAQ,CAACO,OAAT,CAAiB,UAAAC,OAAO;AAAA,2BAAIA,OAAO,EAAX;AAAA,mBAAxB;;AARW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAD,IAAd;AAWD;;AAED;AAAA;AAAA;AAAA;AAAA,iCAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AACLR,kBAAAA,QAAQ,CAACS,MAAT,CAAgBN,MAAhB;;AADK,sBAEAH,QAAQ,CAACK,IAFT;AAAA;AAAA;AAAA;;AAGHR,kBAAAA,MAAM;AAHH;AAAA,yBAIuBE,WAJvB;;AAAA;AAIGW,kBAAAA,WAJH;AAKHA,kBAAAA,WAAW,SAAX,IAAAA,WAAW,WAAX,YAAAA,WAAW;;AALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;AAAA;AAQD;AA1BI,GAAP;AA4BD","sourcesContent":["export default function createSubscription(subscribe, remove) {\n  let value;\n  let subscribing;\n  const updaters = new Set();\n  return {\n    getCurrentValue: () => value,\n    subscribe: update => {\n      updaters.add(update);\n      if (updaters.size === 1) {\n        subscribing = (async () => {\n          try {\n            return await subscribe(nextValue => {\n              value = [null, nextValue];\n              updaters.forEach(updater => updater());\n            });\n          } catch (error) {\n            value = [error];\n            updaters.forEach(updater => updater());\n          }\n        })();\n      }\n\n      return async () => {\n        updaters.delete(update);\n        if (!updaters.size) {\n          remove();\n          const unsubscribe = await subscribing;\n          unsubscribe?.();\n        }\n      };\n    }\n  };\n}\n"],"file":"createSubscription.js"}